!function(e,t){var r=function(e){var l=["N","E","A","D"];function t(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}function r(e,t){Object.defineProperty(this,"kind",{value:e,enumerable:!0}),t&&t.length&&Object.defineProperty(this,"path",{value:t,enumerable:!0})}function O(e,t,r){O.super_.call(this,"E",e),Object.defineProperty(this,"lhs",{value:t,enumerable:!0}),Object.defineProperty(this,"rhs",{value:r,enumerable:!0})}function k(e,t){k.super_.call(this,"N",e),Object.defineProperty(this,"rhs",{value:t,enumerable:!0})}function j(e,t){j.super_.call(this,"D",e),Object.defineProperty(this,"lhs",{value:t,enumerable:!0})}function D(e,t,r){D.super_.call(this,"A",e),Object.defineProperty(this,"index",{value:t,enumerable:!0}),Object.defineProperty(this,"item",{value:r,enumerable:!0})}function f(e,t,r){var n=e.slice((r||t)+1||e.length);return e.length=t<0?e.length+t:t,e.push.apply(e,n),e}function w(e){var t=typeof e;return"object"!==t?t:e===Math?"math":null===e?"null":Array.isArray(e)?"array":"[object Date]"===Object.prototype.toString.call(e)?"date":"function"==typeof e.toString&&/^\/.*\//.test(e.toString())?"regexp":"object"}function u(e){var t=0;if(0===e.length)return t;for(var r=0;r<e.length;r++){var n=e.charCodeAt(r);t=(t<<5)-t+n,t&=t}return t}function x(e){var t=0,r=w(e);if("array"===r){e.forEach(function(e){t+=x(e)});var n="[type: array, hash: "+t+"]";return t+u(n)}if("object"===r){for(var a in e)if(e.hasOwnProperty(a)){var i="[ type: object, key: "+a+", value hash: "+x(e[a])+"]";t+=u(i)}return t}var l="[ type: "+r+" ; value: "+e+"]";return t+u(l)}function A(e,t,r,n,a,i,l,f){r=r||[],l=l||[];var u=(a=a||[]).slice(0);if(null!=i){if(n){if("function"==typeof n&&n(u,i))return;if("object"==typeof n){if(n.prefilter&&n.prefilter(u,i))return;if(n.normalize){var h=n.normalize(u,i,e,t);h&&(e=h[0],t=h[1])}}}u.push(i)}"regexp"===w(e)&&"regexp"===w(t)&&(e=e.toString(),t=t.toString());var o,s,c,p,d=typeof e,b=typeof t,v="undefined"!==d||l&&0<l.length&&l[l.length-1].lhs&&Object.getOwnPropertyDescriptor(l[l.length-1].lhs,i),g="undefined"!==b||l&&0<l.length&&l[l.length-1].rhs&&Object.getOwnPropertyDescriptor(l[l.length-1].rhs,i);if(!v&&g)r.push(new k(u,t));else if(!g&&v)r.push(new j(u,e));else if(w(e)!==w(t))r.push(new O(u,e,t));else if("date"===w(e)&&e-t!=0)r.push(new O(u,e,t));else if("object"===d&&null!==e&&null!==t){for(o=l.length-1;-1<o;--o)if(l[o].lhs===e){p=!0;break}if(p)e!==t&&r.push(new O(u,e,t));else{if(l.push({lhs:e,rhs:t}),Array.isArray(e)){for(f&&(e.sort(function(e,t){return x(e)-x(t)}),t.sort(function(e,t){return x(e)-x(t)})),o=t.length-1,s=e.length-1;s<o;)r.push(new D(u,o,new k(void 0,t[o--])));for(;o<s;)r.push(new D(u,s,new j(void 0,e[s--])));for(;0<=o;--o)A(e[o],t[o],r,n,u,o,l,f)}else{var y=Object.keys(e),m=Object.keys(t);for(o=0;o<y.length;++o)c=y[o],0<=(p=m.indexOf(c))?(A(e[c],t[c],r,n,u,c,l,f),m[p]=null):A(e[c],void 0,r,n,u,c,l,f);for(o=0;o<m.length;++o)(c=m[o])&&A(void 0,t[c],r,n,u,c,l,f)}l.length=l.length-1}}else e!==t&&("number"===d&&isNaN(e)&&isNaN(t)||r.push(new O(u,e,t)))}function h(e,t,r,n,a){var i=[];if(A(e,t,i,n,null,null,null,a),r)for(var l=0;l<i.length;++l)r(i[l]);return i}function n(e,t,r,n){var a=n?function(e){e&&n.push(e)}:void 0,i=h(e,t,a,r);return n||(i.length?i:void 0)}function a(e,t,r){if(void 0===r&&t&&~l.indexOf(t.kind)&&(r=t),e&&r&&r.kind){for(var n=e,a=-1,i=r.path?r.path.length-1:0;++a<i;)void 0===n[r.path[a]]&&(n[r.path[a]]=void 0!==r.path[a+1]&&"number"==typeof r.path[a+1]?[]:{}),n=n[r.path[a]];switch(r.kind){case"A":r.path&&void 0===n[r.path[a]]&&(n[r.path[a]]=[]),function e(t,r,n){if(n.path&&n.path.length){var a,i=t[r],l=n.path.length-1;for(a=0;a<l;a++)i=i[n.path[a]];switch(n.kind){case"A":e(i[n.path[a]],n.index,n.item);break;case"D":delete i[n.path[a]];break;case"E":case"N":i[n.path[a]]=n.rhs}}else switch(n.kind){case"A":e(t[r],n.index,n.item);break;case"D":t=f(t,r);break;case"E":case"N":t[r]=n.rhs}return t}(r.path?n[r.path[a]]:n,r.index,r.item);break;case"D":delete n[r.path[a]];break;case"E":case"N":n[r.path[a]]=r.rhs}}}return t(O,r),t(k,r),t(j,r),t(D,r),Object.defineProperties(n,{diff:{value:n,enumerable:!0},orderIndependentDiff:{value:function(e,t,r,n){var a=n?function(e){e&&n.push(e)}:void 0,i=h(e,t,a,r,!0);return n||(i.length?i:void 0)},enumerable:!0},observableDiff:{value:h,enumerable:!0},orderIndependentObservableDiff:{value:function(e,t,r,n,a,i,l){return A(e,t,r,n,a,i,l,!0)},enumerable:!0},orderIndepHash:{value:x,enumerable:!0},applyDiff:{value:function(t,r,n){t&&r&&h(t,r,function(e){n&&!n(t,r,e)||a(t,r,e)})},enumerable:!0},applyChange:{value:a,enumerable:!0},revertChange:{value:function(e,t,r){if(e&&t&&r&&r.kind){var n,a,i=e;for(a=r.path.length-1,n=0;n<a;n++)void 0===i[r.path[n]]&&(i[r.path[n]]={}),i=i[r.path[n]];switch(r.kind){case"A":!function e(t,r,n){if(n.path&&n.path.length){var a,i=t[r],l=n.path.length-1;for(a=0;a<l;a++)i=i[n.path[a]];switch(n.kind){case"A":e(i[n.path[a]],n.index,n.item);break;case"D":case"E":i[n.path[a]]=n.lhs;break;case"N":delete i[n.path[a]]}}else switch(n.kind){case"A":e(t[r],n.index,n.item);break;case"D":case"E":t[r]=n.lhs;break;case"N":t=f(t,r)}return t}(i[r.path[n]],r.index,r.item);break;case"D":case"E":i[r.path[n]]=r.lhs;break;case"N":delete i[r.path[n]]}}},enumerable:!0},isConflict:{value:function(){return"undefined"!=typeof $conflict},enumerable:!0}}),n.OrderDiff=n,e.OrderDiff=n}(e);if("function"==typeof define&&define.amd)define("OrderDiff",function(){return r});else if("object"==typeof exports)module.exports=r;else{var n=e.OrderDiff;r.noConflict=function(){return e.OrderDiff===r&&(e.OrderDiff=n),r},e.OrderDiff=r}}(this);