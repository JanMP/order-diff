!function(e,n){var t=function(e){var f=["N","E","M","D","R"];function n(e,n){e.super_=n,e.prototype=Object.create(n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}function t(e,n){Object.defineProperty(this,"kind",{value:e,enumerable:!0}),n&&n.length&&Object.defineProperty(this,"path",{value:n,enumerable:!0})}function s(e,n,t){s.super_.call(this,"E",e),void 0!==n&&Object.defineProperty(this,"lhs",{value:n,enumerable:!0}),Object.defineProperty(this,"rhs",{value:t,enumerable:!0})}function _(e,n,t){_.super_.call(this,"N",e),void 0!==t&&Object.defineProperty(this,"lhs",{value:t,enumerable:!0}),Object.defineProperty(this,"rhs",{value:n,enumerable:!0})}function C(e,n){C.super_.call(this,"D",e),Object.defineProperty(this,"lhs",{value:n,enumerable:!0})}function z(e,n,t){z.super_.call(this,"M",e),Object.defineProperty(this,"lhs",{value:n,enumerable:!0}),Object.defineProperty(this,"rhs",{value:t,enumerable:!0})}function F(e,n,t){F.super_.call(this,"R",e),Object.defineProperty(this,"lhs",{value:n,enumerable:!0}),Object.defineProperty(this,"rhs",{value:t,enumerable:!0})}function p(e){return"function"==typeof e?e:function(){return e}}function d(e){var n=typeof e;return"object"!==n?n:e===Math?"math":null===e?"null":Array.isArray(e)?"array":"[object Date]"===Object.prototype.toString.call(e)?"date":"function"==typeof e.toString&&/^\/.*\//.test(e.toString())?"regexp":"object"}function v(e){var n=0;if(0===e.length)return n;for(var t=0;t<e.length;t++){var r=e.charCodeAt(t);n=(n<<5)-n+r,n&=n}return n}function q(e,n,t,r){n=p(n),t=t||[],r=r||[];var o,i=0,c=[],f=d(e);if(("array"===f||"object"===f)&&-1!==(o=r.indexOf(e)))return v(t.slice(o).join(","));if("array"===f){var u;if(n(t)){for(o=0;o<e.length;++o)i+=q(e[o],n,t.concat(0),r.concat([e]));u="[type: array, hash: "+i+"]"}else{for(o=0;o<e.length;++o)c.push(q(e[o],n,t.concat(o),r.concat([e])));u="[type: array, hash: "+c.join(", ")+"]"}return v(u)}if("object"===f){var a,l,h;if(!1!==n(t)){for(h in e)e.hasOwnProperty(h)&&(a="key: "+h+", value hash: "+q(e[h],n,t.concat(h),r.concat(e)),i+=v(a));l="[type: object, hash: "+i+"]"}else{for(h in e)e.hasOwnProperty(h)&&(a="key: "+h+", value hash: "+q(e[h],n,t.concat(h),r.concat(e)),c.push(v(a)));l="[type: object, hash: "+c.join(", ")+"]"}return v(l)}var s="[ type: "+f+" ; value: "+e+"]";return v(s)}function H(e,n,t){var r,o=d(e),i=[],c=[],f=0;if(o!==d(n))return!1;if("array"!==o&&"object"!==o)return!0;if("array"===o){for(r=0;r<e.length;++r)i.push(q(e[r]));for(r=0;r<n.length;++r)c.push(q(n[r]))}else"object"===o&&(i=Object.keys(e),c=Object.keys(n));return i.forEach(function(e){-1!==c.indexOf(e)&&++f}),f>i.length*t&&f>c.length*t}function I(e,n,t,r,o){if(t=p(t),r=r||[],o=o||[],e===n)return!0;if(d(e)!==d(n))return!1;if("date"===d(e))return e-n==0;if("number"==typeof e&&isNaN(e)&&isNaN(n))return!0;if(-1!==o.indexOf(n))return e===n;if(q(e,t)!==q(n,t))return!1;if(Array.isArray(e)){var i;if(e.length!==n.length)return!1;if(t(r)){var c,f={};for(n.forEach(function(e,n){c=q(e,t),f[c]?f[c].push(n):f[c]=[n]}),i=0;i<e.length;++i){if(c=q(e[i],t),!f[c])return!1;var u;for(u=0;u<f[c].length&&!I(e[i],n[f[c][u]],t,r.concat(f[c][u]),o.concat([n]));++u);if(u===f[c].length)return!1}}else for(i=0;i<e.length;++i)if(!I(e[i],n[i],t,r.concat(i),o.concat([n])))return!1;return!0}var a;if(!1===t(r)&&!I(Object.keys(e),Object.keys(n),t))return!1;for(a in e)if(e.hasOwnProperty(a)){if(!n.hasOwnProperty(a))return!1;if(!I(e[a],n[a],t,r.concat(a),o.concat(n)))return!1}for(a in n)if(n.hasOwnProperty(a)&&!n.hasOwnProperty(a))return!1;return!0}function $(n){return function(e){return n[e]}}function B(e){var t=Object.keys(e);return function(e,n){return t[n]}}function b(e,r,o,i,c,f,u,a,l){var n,t,h,s,p,d=[],v=[];"object"===f?function(e,n,t,r,o,i,c,f){var u,a,l,h=Object.keys(e),s=Object.keys(n);for(u=0;u<h.length;++u)a=h[u],void 0!==n[a]?(r[s.indexOf(a)]=u,I(e[a],n[a],o,c.concat(a),f.concat(n))?t.push([a,s.indexOf(a)]):t.push([a,s.indexOf(a),!0])):t.push([a,-1]);for(l=void 0,u=0;u<h.length;++u)-1===t[u][1]?(a=l?l[1]+1:0)<s.length&&void 0===r[a]&&I(e[h[u]],n[s[a]],o,c.concat(s[a]),f.concat(n))&&(t[u][1]=a,r[a]=u):l=t[u];for(l=void 0,u=h.length-1;0<=u;--u)-1===t[u][1]?0<=(a=l?l[1]-1:s.length-1)&&void 0===r[a]&&I(e[h[u]],n[s[a]],o,c.concat(s[a]),f.concat(n))&&(t[u][1]=a,r[a]=u):l=t[u];if(!0!==i(c)){for(l=void 0,u=0;u<h.length;++u)-1===t[u][1]?(a=l?l[1]+1:0)<s.length&&void 0===r[a]&&H(e[h[u]],n[s[a]],i(c.concat(h[u])))&&(t[u][1]=a,t[u][2]=!0,r[a]=u):l=t[u];for(l=void 0,u=h.length-1;0<=u;--u)-1===t[u][1]?0<=(a=l?l[1]-1:s.length-1)&&void 0===r[a]&&H(e[h[u]],n[s[a]],i(c.concat(h[u])))&&(t[u][1]=a,t[u][2]=!0,r[a]=u):l=t[u]}r.length=s.length}(e,r,d,v,u,a,c,l):function(e,t,r,n,o,i,c,f){var u,a,l,h,s,p={},d={};for(e.forEach(function(e,n){r.push([n,-1]),s=q(e,o,c.concat(n),f.concat([t])),p[s]?p[s].push(n):p[s]=[n]}),t.forEach(function(e,n){s=q(e,o,c.concat(n),f.concat([t])),d[s]?d[s].push(n):d[s]=[n]}),h=void 0,u=0;u<e.length;++u)-1===r[u][1]?(s=q(e[u],o,c.concat(u),f.concat([t])),d[s]&&((l=h?h[1]+1:0)<t.length&&void 0===n[l]&&I(e[u],t[l],o,c.concat(l),f.concat([t]))?(r[u][1]=l,n[l]=u,d[s].splice(d[s].indexOf(l),1),0===d[s].length&&delete d[s],p[s].splice(p[s].indexOf(u),1),0===p[s].length&&delete p[s],h=[u,l]):1===p[s].length&&1===d[s].length&&I(e[u],t[d[s][0]],o,c.concat(d[s][0]),f.concat([t]))&&(l=d[s][0],r[u][1]=l,n[l]=u,delete d[s],delete p[s],h=[u,l]))):h=r[u];for(h=void 0,u=e.length-1;0<=u;--u)-1===r[u][1]?(s=q(e[u],o,c.concat(u),f.concat([t])),d[s]&&(0<=(l=h?h[1]-1:t.length-1)&&void 0===n[l]&&I(e[u],t[l],o,c.concat(l),f.concat([t]))?(r[u][1]=l,n[l]=u,d[s].splice(d[s].indexOf(l),1),0===d[s].length&&delete d[s],p[s].splice(p[s].indexOf(u),1),0===p[s].length&&delete p[s],h=[u,l]):1===p[s].length&&1===d[s].length&&I(e[u],t[d[s][0]],o,c.concat(d[s][0]),f.concat([t]))&&(l=d[s][0],r[u][1]=l,n[l]=u,delete d[s],delete p[s],h=[u,l]))):h=r[u];for(u=0;u<e.length;++u)if(-1===r[u][1]){if(s=q(e[u],o,c.concat(u),f.concat([t])),d[s]){for(a=0;a<d[s].length&&!I(e[u],t[d[s][a]],o,c.concat(d[s][a]),f.concat([t]));++a);a!==d[s].length&&(l=d[s][a],r[u][1]=l,n[l]=u,d[s].splice(a,1),0===d[s].length&&delete d[s],p[s].splice(p[s].indexOf(u),1),0===p[s].length&&delete p[s])}}else h=r[u];if(!0!==i(c)){for(h=void 0,u=0;u<e.length;++u)-1===r[u][1]?h&&(l=h[1]+1)<t.length&&void 0===n[l]&&H(e[u],t[l],i(c.concat(u)))&&(r[u][1]=l,r[u][2]=!0,n[l]=u,h=[u,l]):h=r[u];for(h=void 0,u=e.length-1;0<=u;--u)-1===r[u][1]?h&&0<=(l=h[1]-1)&&void 0===n[l]&&H(e[u],t[l],i(c.concat(u)))&&(r[u][1]=l,r[u][2]=!0,n[l]=u,h=[u,l]):h=r[u]}n.length=t.length}(e,r,d,v,u,a,c,l);var b,g,y,j,O,m,k,w="object"===f?(b=e,function(e){return b[e]}):$(e),x="object"===f?(g=r,y=Object.keys(g),function(e){return g[y[e]]}):$(r),P="object"===f?(j=d,function(e){return j[e][0]}):function(e){return e},D="object"===f?B(r):function(e){return e},N="object"===f?B(r):function(){return-1},E="object"===f?(O=d,function(e){if(0!==e)return O[e-1][0]}):function(e){return e},A="object"===f?(m=r,k=Object.keys(m),function(e){return k[e]}):void 0;function M(e){var n=d[e][0],t=d[e][1];d[e][2]&&(i(c,P(e),"E",w(n),x(t))||G(w(n),x(t),o,i,c.concat(P(e)),u,a,l.concat([r]))),"object"===f&&n!==A(t)&&(i(c,P(e),"R",w(e),A(t))||(o.push(new F(c.concat(P(e)),w(e),A(t))),d[e][0]=A(t)))}var R=v.length,S=0;if("array"===f&&u(c)||"object"===f&&!1!==u(c))for(t=n=0;n<d.length||n<R+S;)n<d.length&&-1===d[n][1]?i(c,P(n),"D",w(d[n][0]))?(++S,++n):(o.push(new C(c.concat(P(n)),w(d[n][0]))),d.splice(n,1)):t<v.length&&void 0===v[t]?(i(c,D(n,t),"N",void 0,x(t))?--S:(o.push(new _(c.concat(D(n,t)),x(t),"object"===f?void 0:E(t))),d.splice(n,0,[N(n,t),t]),++n),++t):n<d.length&&d[n]&&-1!==d[n][1]?(M(n),++n):t<v.length&&void 0!==v[t]&&++t;else for(n=0;n<d.length||n<R+S;)if(n<d.length&&-1===d[n][1])i(c,P(n),"D",w(d[n][0]))?(++S,++n):(o.push(new C(c.concat(P(n)),w(d[n][0]))),d.splice(n,1));else if(n-S<v.length&&void 0===v[n-S])i(c,D(n,n-S),"N",void 0,x(n-S))?--S:(o.push(new _(c.concat(D(n,n-S)),x(n-S),E("object"===f?n:n-S))),d.splice(n,0,[N(n,n-S),n-S]),++n);else if(n<d.length&&d[n][1]<=n-S)M(n),d[n][1]<n-S&&--S,++n;else{for(h=n+1;h<d.length&&d[h][1]!==n-S;++h);if(h!==d.length){for(p=1;p<d.length-h&&d[h+p][1]===n-S+p;++p);if(n<d.length&&void 0!==v[d[n][1]-1]){for(t=d[n][1],s=1;s<d.length-n&&d[n+s][1]===t+s;++s);if(s<p){for(p=d[n][1]-1,h=n+s;d[h][1]!==p;++h);for(t=0;t<s;++t)i(c,P(n),"M",w(d[n][0]),E(h+1))?(M(n),++S,++n):(o.push(new z(c.concat(P(n)),w(d[n][0]),E(h+1))),d.splice(h+1,0,d.splice(n,1)[0]));continue}}for(t=0;t<p;++t)i(c,P(h+t),"M",w(d[h+t][0]),E(n))?++S:(o.push(new z(c.concat(P(h+t)),w(d[h+t][0]),E(n))),d.splice(n,0,d.splice(h+t,1)[0]),M(n),++n)}else--S}}function G(e,n,t,r,o,i,c,f){"regexp"===d(e)&&"regexp"===d(n)&&(e=e.toString(),n=n.toString());var u=typeof e,a=typeof n,l="undefined"!==u,h="undefined"!==a;if(!l&&h)t.push(new _(o,n));else if(!h&&l)t.push(new C(o,e));else if(d(e)!==d(n))t.push(new s(o,e,n));else if("date"===d(e)&&e-n!=0)t.push(new s(o,e,n));else{if(-1!==f.indexOf(n))return void(e!==n&&t.push(new s(o,e,n)));"object"===u&&null!==e&&null!==n?b(e,n,t,r,o,Array.isArray(e)?"array":"object",i,c,f):e!==n&&("number"===u&&isNaN(e)&&isNaN(n)||t.push(new s(o,e,n)))}}function a(e,n,t,r,o,i){var c=[];if(G(e,n,c,function(i){if(i){if("function"==typeof i)return function(e,n,t){return i(e,n,t)};if("object"==typeof i){if(i.prefilter)return function(e,n,t){return i.prefilter(e,n,t)};if(i.normalize)return function(e,n,t,r,o){return i.normalize(e,n,t,r,o)}}}return function(){return!1}}(r),[],p(o),p(i||.5),[]),t)for(var f=0;f<c.length;++f)t(c[f]);return c}function r(e,n,t,r,o,i){var c=r?function(e){e&&r.push(e)}:void 0,f=a(e,n,c,t,o,i);return r||f}function u(e,n,t){var r=-1,o=(n=n||[]).length-1;if(-1===o)return!0;for(;++r<o;){if(void 0===e[n[r]]){if(!t)return!1;e[n[r]]="number"==typeof n[r+1]?[]:{}}e=e[n[r]]}var i="number"==typeof n[o]?"array":"object";return d(e)===i&&e}function l(e,n,t,r){for(var o=Object.keys(e),i={};t<o.length;++t)i[o[t]]=e[o[t]],delete e[o[t]];for(n in e[n]=r,i)e[n]=i[n]}function h(e,n,t,r){var o,i=Object.keys(e);void 0===t?o=0:-1===(o=i.indexOf(t))?o=i.length:++o,l(e,n,o,r)}function g(e,n,t){void 0===t&&n&&~f.indexOf(n.kind)&&(t=n,n=void 0);var r=t.path;if(!r)return!0;var o,i=r[r.length-1],c=u(e,r,!0);if(!c)return!1;if(n&&!(o=u(n,r)))return!1;switch(t.kind){case"M":if(n&&"number"!=typeof i&&t.rhs&&d(t.lhs)!==d(o[t.rhs]))return!1;"number"==typeof i?c.splice(t.rhs,0,c.splice(i,1)[0]):function(e,n,t,r){var o=e[n];void 0!==o&&(r=o,delete e[n]);h(e,n,t,r)}(c,i,t.rhs,t.lhs);break;case"D":if(d(c[i])!==d(t.lhs))return!1;"number"==typeof i?c.splice(i,1):delete c[i];break;case"E":if(n)if("number"==typeof i){if(!function(e,n){for(var t=q(n,!1),r=0;r<e.length;++r)if(t===q(e[r],!1)&&I(e[r],n,!1))return!0;return!1}(o,t.rhs))return!1}else if(!I(o[i],t.rhs,!1))return!1;if(c[i]&&d(c[i])!==d(t.lhs))return!1;c[i]=t.rhs;break;case"N":if(n&&!I(o="number"==typeof i?o[t.lhs]:o[i],t.rhs,!1))return!1;"number"==typeof i?c.splice(i,0,t.rhs):t.lhs?h(c,i,t.lhs,t.rhs):c[i]=t.rhs;break;case"R":!function(e,n,t,r){var o,i=e[n];void 0!==i?(r=i,o=Object.keys(e).indexOf(n),delete e[n]):o=Object.keys(e).length;l(e,t,o,r)}(c,i,t.rhs,t.lhs);break;default:return!1}return!0}return n(s,t),n(_,t),n(C,t),n(z,t),n(F,t),Object.defineProperties(r,{diff:{value:r,enumerable:!0},observableDiff:{value:a,enumerable:!0},orderIndepHash:{value:q,enumerable:!0},objectSimilar:{value:H,enumerable:!0},objectEqual:{value:I,enumerable:!0},applyDiff:{value:function(n,t,e,r,o,i,c){Array.isArray(e)||(c=i,i=o,o=r,r=e,e=void 0);var f=[],u=function(e){if(!r||r(n,t,e)){if(!e.path)throw n=e.rhs,"FullReplace";g(n,t,e)||f.push(e)}};try{e?e.forEach(u):a(n,t,u,o,i,c)}catch(e){if("FullReplace"===e)return n}if(f.length)throw f;return n},enumerable:!0},applyChange:{value:g,enumerable:!0},isConflict:{value:function(){return"undefined"!=typeof $conflict},enumerable:!0}}),r.OrderDiff=r,e.OrderDiff=r}(e);if("function"==typeof define&&define.amd)define("OrderDiff",function(){return t});else if("object"==typeof exports)module.exports=t;else{var r=e.OrderDiff;t.noConflict=function(){return e.OrderDiff===t&&(e.OrderDiff=r),t},e.OrderDiff=t}}(this);